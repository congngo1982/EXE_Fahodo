<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product</title>
    <link rel="stylesheet" href="styles/style_product.css">
    <link href="https://fonts.googleapis.com/css2?family=Concert+One&family=GFS+Neohellenic&display=swap"
        rel="stylesheet">
    <script src="action/ultils.js"></script>
</head>

<body onload="OnLoadMain()">
    <div id="header" w3-include-html="header.html"
        style="position: relative; width: 90%; margin-left: 5%; background-color: white; z-index: 2;"></div>

    <div class="body">
        <div class="row">
            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6" style="padding: 1%;">
                <div class="row" style="position: relative; width: 100%; overflow: hidden;">
                    <div class="col-12 col-xs-8 col-sm-8 col-md-8 col-lg-8">
                        <img class="poster" id="book_poster" src="images/conan.jpg" alt="">
                    </div>
                    <div class="col-12 col-xs-4 col-sm-4 col-md-4 col-lg-4" style="overflow: hidden;">
                        <div class="subPoster" id="book_subPoster">
                            <div class=""><img class="subPosterImage" src="images/conan.jpg" alt=""></div>
                            <div class=""><img class="subPosterImage" src="images/conan.jpg" alt=""></div>
                            <div class=""><img class="subPosterImage" src="images/conan.jpg" alt=""></div>
                            <div class=""><img class="subPosterImage" src="images/conan.jpg" alt=""></div>
                            <div class=""><img class="subPosterImage" src="images/conan.jpg" alt=""></div>
                            <!-- <img class="subPoster" src="images/conan.jpg" alt=""> -->
                            <!-- <img class="subPoster" src="images/conan.jpg" alt="">
                            <img class="subPoster" src="images/conan.jpg" alt="">
                            <img class="subPoster" src="images/conan.jpg" alt=""> -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6" style="padding: 1%;">
                <div class="book">
                    <div style="font-size: 150%;" id="book_author">Tác giả: Gosho Aoyama</div>
                    <div style="font-size: 200%;" id="book_name">Conan</div>
                    <div style="font-family: GFS Neohellenic; color: rgb(80, 80, 80);"><span id="book_rating">⭐⭐⭐⭐⭐
                        </span><span id="book_watching"> 1
                            Viewer</span></div>
                    <div style="font-family: GFS Neohellenic; color: rgb(80, 80, 80);" id="book_description">
                        “Muôn kiếp nhân sinh” là tác phẩm do Giáo sư John Vũ - Nguyên Phong viết từ năm 2017 và hoàn tất
                        đầu năm 2020 ghi lại những câu chuyện, trải nghiệm tiền kiếp kỳ lạ từ nhiều kiếp sống của người
                        bạn tâm giao lâu năm, ông Thomas - một nhà kinh doanh tài chính nổi tiếng ở New York. Những câu
                        chuyện chưa từng tiết lộ này sẽ giúp mọi người trên thế giới chiêm nghiệm, khám phá các quy luật
                        về luật Nhân quả và Luân hồi của vũ trụ giữa lúc trái đất đang gặp nhiều tai ương, biến động,
                        khủng hoảng từng ngày.
                    </div>
                    <br>
                    <div style="font-family: GFS Neohellenic; color: rgb(80, 80, 80);">
                        Công ty phát hành: Nhã Nam <br>
                        Ngày xuất bản: 01/07/2019 <br>
                        Số trang: 220 <br>
                        Nhà xuất bản: Nhà xuất bản thế giới <br>
                        Thể loại:
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6" style="padding: 1%;">
                <div class="book">
                    <div style="font-size: 120%;">Reviews</div>
                    <div style="font-size: 120%;">Most reviews</div>

                    <div id="book_comment"></div>

                    <!-- <div id="reviews" class="review">
                        <div style="font-size: 120%;">Nguyen Cong Ngo &nbsp<span
                                style="font-size: 80%; color: rgb(80, 80, 80);">&nbsp 23/09/2023</span></div>
                        <div style="font-size: 80%; color: rgb(80, 80, 80);">Lorem ipsum dolor sit amet, consectetuer
                            adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet. </div>
                    </div>
                    <div id="reviews" class="review">
                        <div style="font-size: 120%;">Nguyen Cong Ngo &nbsp<span
                                style="font-size: 80%; color: rgb(80, 80, 80);">&nbsp 23/09/2023</span></div>
                        <div style="font-size: 80%; color: rgb(80, 80, 80);">Lorem ipsum dolor sit amet, consectetuer
                            adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet. Lorem ipsum dolor sit
                            amet, consectetur adipiscing elit. Aliquam placerat.
                        </div>
                    </div> -->
                </div>
            </div>
            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6" style="padding: 1%;">
                <div class="book">
                    <div style="font-size: 120%;">Add a review</div>
                    <div style="font-size: 80%; color: rgb(80, 80, 80);">Your email address will not be published.
                        Required fields are marked *</div>
                    <form action="">
                        <input type="text" name="txtReview" id="txtReview" class="reviewInput" value=""
                            required="required" placeholder="Your Review*">
                        <input type="text" name="txtEmail" id="txtEmail" class="reviewInput" value=""
                            required="required" placeholder="Enter your Email*">
                        <div style="font-size: 100%; color: rgb(80, 80, 80); border: none;" class="reviewInput">Your
                            Rating*</div>
                        <div>⭐⭐⭐⭐⭐</div>
                        <br>
                        <button type="button" class="btn btn-dark" onclick="PostComment()">Submit</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div style="margin-top: 2%;" w3-include-html="footer.html"></div>

    <script>
        // window.onscroll = OnScroll;
        includeHTML();

        var book_information;
        var url = window.location.href;
        var id = url.split("?")[1].split("=")[1];

        function OnLoadMain() {
            CallAjax("GET", `http://localhost:8080/book/getbookbyId/${id}`, BookInformation);
        }

        function BookInformation(result) {
            result = JSON.parse(result);
            var commentTemplate = function (name, date, content) {
                return `<div id="reviews" class="review">
                        <div style="font-size: 120%;">${name} &nbsp<span
                                style="font-size: 80%; color: rgb(80, 80, 80);">&nbsp ${date}</span></div>
                        <div style="font-size: 80%; color: rgb(80, 80, 80);">${content}</div>
                    </div>`;
            }

            var author = result.author.fullName;
            var publicDate = result.publicDate;
            var name = result.title;
            var description = result.description;
            var watching = result.watching;
            var rating = result.rating;
            var rate = "⭐⭐⭐⭐⭐";
            if (rating < 2.0) {
                rate = "⭐";
            } else if (rating < 3.0) {
                rate = "⭐⭐"
            } else if (rating < 4.0) {
                rate = "⭐⭐⭐";
            } else if (rating < 5.0) {
                rate = "⭐⭐⭐⭐";
            }
            var poster = "";
            var subPoster = "";
            var img = result.bookImages;
            img.forEach(element => {
                if (element.type == "poster") {
                    poster = element.source;
                } else if (element.type == "image") {
                    subPoster += `<div class=""><img class="subPosterImage" src="${element.source}" alt=""></div>`;
                }
            });
            var comment = "";
            var cmt = result.comments;
            cmt.forEach(e => {
                comment += commentTemplate(e.account.fullName, e.date, e.content);
            });

            document.getElementById("book_author").innerHTML = author;
            // document.getElementById("book").innerHTML = publicDate;
            document.getElementById("book_name").innerHTML = name;
            document.getElementById("book_description").innerHTML = description;
            document.getElementById("book_watching").innerHTML = watching + " viewers";
            document.getElementById("book_rating").innerHTML = rate;
            document.getElementById("book_subPoster").innerHTML = subPoster;
            document.getElementById("book_poster").src = poster;
            document.getElementById("book_comment").innerHTML = comment;
            console.log(result);
        }

        function CallAjax(method, url, funcCallBack) {
            const xhttp = new XMLHttpRequest();
            var result;
            xhttp.onload = function () {
                funcCallBack(this.responseText);
            }
            xhttp.open(method, url, false);
            xhttp.send();
        }

        function PostComment() {
            var comments = {
                account: null,
                content: document.getElementById("txtReview").value,
                date: new Date(),
            }

            let post = JSON.stringify(comments);

            let xhr = new XMLHttpRequest()
            xhr.open("POST", `http://localhost:8080/comment/postcomment/${id}`, true)
            xhr.setRequestHeader('Content-type', 'application/json; charset=UTF-8')
            if (post != null) {
                xhr.send(post);
            }
            xhr.onload = function () {
                OnLoadMain();
            }
        }
    </script>
</body>

</html>